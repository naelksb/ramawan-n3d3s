<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramawan: Edisi Supermarket</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d7a4f">
    <link rel="apple-touch-icon" href="assets/images/icon-192.png">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed', err));
            });
        }
    </script>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- 3. Babel (untuk compile JSX di browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Custom CSS Animasi -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: white;
        }

        /* Animasi Bintang */
        .animate-twinkle {
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.2;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.5);
            }
        }

        /* Animasi Blob */
        .animate-pulse-slow {
            animation: pulse 8s infinite;
        }

        /* Animasi Masuk */
        .animate-fade-in {
            animation: fade-in 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        .animate-slide-up {
            animation: slide-up 0.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }

        .animate-bounce-in {
            animation: bounce-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(100%);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: translate(-50%, -20px) scale(0.9);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, 0) scale(1);
            }
        }

        /* Scrollbar Sembunyi */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- KODE APLIKASI -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICON HELPERS ---
        const Icon = ({ children, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const PieChart = (p) => <Icon {...p}><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></Icon>;
        const ShoppingBag = (p) => <Icon {...p}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></Icon>;
        const TrendingUp = (p) => <Icon {...p}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></Icon>;
        const TrendingDown = (p) => <Icon {...p}><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></Icon>;
        const List = (p) => <Icon {...p}><line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" /></Icon>;
        const Plus = (p) => <Icon {...p}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></Icon>;
        const Search = (p) => <Icon {...p}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></Icon>;
        const Save = (p) => <Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></Icon>;
        const Package = (p) => <Icon {...p}><path d="m16.5 9.4-9-5.19" /><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" /><polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /></Icon>;
        const Calendar = (p) => <Icon {...p}><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></Icon>;
        const Bot = (p) => <Icon {...p}><rect x="3" y="11" width="18" height="10" rx="2" /><circle cx="12" cy="5" r="2" /><path d="M12 7v4" /><line x1="8" y1="16" x2="8" y2="16" /><line x1="16" y1="16" x2="16" y2="16" /></Icon>;
        const X = (p) => <Icon {...p}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></Icon>;
        const Check = (p) => <Icon {...p}><polyline points="20 6 9 17 4 12" /></Icon>;
        const Sparkles = (p) => <Icon {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /></Icon>;
        const BarChart2 = (p) => <Icon {...p}><line x1="18" y1="20" x2="18" y2="10" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="6" y1="20" x2="6" y2="14" /></Icon>;
        const AlertCircle = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></Icon>;
        const QrCode = (p) => <Icon {...p}><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></Icon>;
        const History = (p) => <Icon {...p}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12" /></Icon>;
        const Activity = (p) => <Icon {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12" /></Icon>;
        const Wallet = (p) => <Icon {...p}><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" /><path d="M4 6v12a2 2 0 0 0 2 2h14v-4" /><path d="M18 12a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v-8z" /></Icon>;
        const ArrowUpRight = (p) => <Icon {...p}><line x1="7" y1="17" x2="17" y2="7" /><polyline points="7 7 17 7 17 17" /></Icon>;
        const ArrowDownRight = (p) => <Icon {...p}><line x1="7" y1="7" x2="17" y2="17" /><polyline points="17 7 17 17 7 17" /></Icon>;
        const Calculator = (p) => <Icon {...p}><rect x="4" y="2" width="16" height="20" rx="2" /><line x1="8" y1="6" x2="16" y2="6" /><line x1="16" y1="14" x2="16" y2="14" /><line x1="12" y1="14" x2="12" y2="14" /><line x1="8" y1="14" x2="8" y2="14" /><line x1="16" y1="18" x2="16" y2="18" /><line x1="12" y1="18" x2="12" y2="18" /><line x1="8" y1="18" x2="8" y2="18" /></Icon>;
        const User = (p) => <Icon {...p}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></Icon>;
        const ClipboardList = (p) => <Icon {...p}><rect x="8" y="2" width="8" height="4" rx="1" ry="1" /><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /><path d="M12 11h4" /><path d="M12 16h4" /><path d="M8 11h.01" /><path d="M8 16h.01" /></Icon>;
        const Coins = (p) => <Icon {...p}><circle cx="8" cy="8" r="6" /><path d="M18.09 10.37A6 6 0 1 1 10.34 18" /><path d="M7 6h1v4" /><path d="m16.71 13.88.7 .71-2.82 2.82" /></Icon>;
        const Target = (p) => <Icon {...p}><circle cx="12" cy="12" r="10" /><circle cx="12" cy="12" r="6" /><circle cx="12" cy="12" r="2" /></Icon>;
        const Gamepad2 = (p) => <Icon {...p}><line x1="6" y1="11" x2="10" y2="11" /><line x1="8" y1="9" x2="8" y2="13" /><line x1="15" y1="12" x2="15.01" y2="12" /><line x1="18" y1="10" x2="18.01" y2="10" /><path d="M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z" /></Icon>;
        const Heart = (p) => <Icon {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></Icon>;
        const Zap = (p) => <Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" /></Icon>;
        const CreditCard = (p) => <Icon {...p}><rect x="2" y="5" width="20" height="14" rx="2" /><line x1="2" y1="10" x2="22" y2="10" /></Icon>;
        const Music = (p) => <Icon {...p}><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></Icon>;
        const Smartphone = (p) => <Icon {...p}><rect x="5" y="2" width="14" height="20" rx="2" ry="2" /><line x1="12" y1="18" x2="12.01" y2="18" /></Icon>;
        const MonitorPlay = (p) => <Icon {...p}><path d="m10 7 5 3-5 3z" /><rect x="2" y="3" width="20" height="14" rx="2" ry="2" /><line x1="12" y1="17" x2="12" y2="21" /><line x1="8" y1="21" x2="16" y2="21" /></Icon>;
        const Tag = (p) => <Icon {...p}><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l5 5a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828l-5-5z" /><circle cx="7.5" cy="7.5" r=".5" fill="currentColor" /></Icon>;

        // --- COMPONENTS ---

        const StokChart = ({ items }) => {
            const data = items.reduce((acc, item) => {
                const total = item.price * item.qty;
                acc[item.category] = (acc[item.category] || 0) + total;
                return acc;
            }, {});

            const categories = Object.keys(data);
            const values = Object.values(data);
            const maxVal = Math.max(...values, 1);

            return (
                <div className="mt-6 p-5 rounded-3xl border border-white/10 shadow-lg backdrop-blur-md bg-slate-900/60 text-white relative overflow-hidden">
                    <div className="flex items-center justify-between mb-6 relative z-10">
                        <h3 className="font-bold text-sm flex items-center gap-2 text-cyan-400">
                            <PieChart size={16} /> Komposisi Belanja
                        </h3>
                        <span className="text-[10px] font-bold opacity-60 bg-white/10 px-2 py-1 rounded-lg">Real-time</span>
                    </div>

                    <div className="flex items-end justify-between h-32 gap-3 px-2 relative z-10">
                        {categories.length === 0 ? (
                            <div className="w-full h-full flex items-center justify-center opacity-40 text-xs">Belum ada belanja</div>
                        ) : categories.map((cat, idx) => {
                            const height = (data[cat] / maxVal) * 100;
                            const barColors = ['bg-cyan-500', 'bg-blue-500', 'bg-indigo-500', 'bg-violet-500', 'bg-fuchsia-500'];

                            return (
                                <div key={cat} className="flex flex-col items-center flex-1 group relative h-full justify-end">
                                    <div className="absolute -top-10 opacity-0 group-hover:opacity-100 transition-opacity bg-black text-white text-[10px] py-1 px-2 rounded-lg whitespace-nowrap z-20 pointer-events-none mb-1 border border-white/20">
                                        Rp {data[cat].toLocaleString('id-ID')}
                                    </div>
                                    <div
                                        style={{ height: `${height}%` }}
                                        className={`w-full max-w-[24px] rounded-t-lg transition-all duration-1000 ease-out hover:shadow-[0_0_15px_currentColor] cursor-pointer relative group-hover:scale-y-105 origin-bottom ${barColors[idx % barColors.length]}`}
                                    ></div>
                                    <span className="text-[9px] font-bold mt-2 truncate w-full text-center opacity-70">{cat}</span>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentView, setCurrentView] = useState('dashboard');

            // UI State
            const [showAddModal, setShowAddModal] = useState(false);
            const [showAddTarget, setShowAddTarget] = useState(false);
            const [showAI, setShowAI] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [showQRIS, setShowQRIS] = useState(false);
            const [showCalculator, setShowCalculator] = useState(false);
            const [notification, setNotification] = useState(null);

            // Data State
            const [newItem, setNewItem] = useState({ name: '', price: '', category: 'Dapur', qty: 1 });
            const [newTarget, setNewTarget] = useState({ name: '', goal: '', saved: 0, icon: 'üéØ' });

            // Calculator State (UNIT PRICE COMPARISON)
            const [calcUnit, setCalcUnit] = useState({ price: '', size: '', result: 0 });

            // QRIS State
            const [qrisAmount, setQrisAmount] = useState('');

            const [aiMessage, setAiMessage] = useState("Halo Bunda! Ada promo minyak goreng nggak hari ini?");
            const [isAiTyping, setIsAiTyping] = useState(false);

            // DATA BELANJA SUPERMARKET
            const [items, setItems] = useState([
                { id: 1, name: 'Minyak Goreng 2L', category: 'Dapur', price: 34500, qty: 2, image: 'üåª', date: 'Baru Saja', unit: 'Pouch' },
                { id: 2, name: 'Deterjen Cair', category: 'Kebersihan', price: 28000, qty: 1, image: 'üßº', date: 'Kemarin', unit: 'Botol 800ml' },
                { id: 3, name: 'Telur Ayam', category: 'Dapur', price: 26000, qty: 1, image: 'ü•ö', date: 'Kemarin', unit: 'Tray 1kg' },
                { id: 4, name: 'Snack Keripik', category: 'Jajan', price: 12000, qty: 3, image: 'üçü', date: '2 Hari Lalu', unit: 'Bks' },
            ]);

            const [targets, setTargets] = useState([
                { id: 1, name: 'Blender Baru', goal: 500000, saved: 250000, icon: 'üå™Ô∏è' },
                { id: 2, name: 'Stok Daging Lebaran', goal: 1500000, saved: 300000, icon: 'ü•©' },
            ]);

            const [wallets, setWallets] = useState([
                { id: 1, name: 'Dompet Fisik', balance: 750000, icon: <Wallet size={16} />, color: 'text-emerald-400', bg: 'bg-emerald-500/10' },
                { id: 2, name: 'Debit BCA', balance: 2500000, icon: <CreditCard size={16} />, color: 'text-blue-400', bg: 'bg-blue-500/10' },
                { id: 3, name: 'GoPay/OVO', balance: 150000, icon: <Smartphone size={16} />, color: 'text-purple-400', bg: 'bg-purple-600/10' },
            ]);

            const [subs, setSubs] = useState([
                { id: 1, name: 'Listrik Token', price: 200000, date: 'Tiap Habis', icon: <Zap size={14} /> },
                { id: 2, name: 'WiFi Rumah', price: 350000, date: 'Tgl 20', icon: <MonitorPlay size={14} /> },
            ]);

            const totalPengeluaran = items.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const anggaranBulanan = 4000000; // Anggaran Belanja Rumah Tangga
            const sisaAnggaran = anggaranBulanan - totalPengeluaran;
            const persentaseSisa = (sisaAnggaran / anggaranBulanan) * 100;

            let level = "Boros Banget";
            let levelColor = "text-red-400";
            if (persentaseSisa > 70) { level = "Super Irit"; levelColor = "text-emerald-400"; }
            else if (persentaseSisa > 40) { level = "Bunda Cermat"; levelColor = "text-cyan-400"; }
            else if (persentaseSisa > 20) { level = "Waspada"; levelColor = "text-yellow-400"; }

            const showNotification = (msg, type) => {
                setNotification({ msg, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const handleAddItem = (itemData) => {
                const data = itemData || newItem;

                if (!data.name || !data.price) {
                    showNotification("Nama & Harga Barang wajib diisi!", "error");
                    return;
                }
                const newEntry = {
                    id: items.length + 1,
                    name: data.name,
                    category: data.category || 'Lainnya',
                    price: parseInt(data.price),
                    qty: parseInt(data.qty) || 1,
                    unit: 'Pcs',
                    image: 'üõí',
                    date: 'Baru Saja'
                };
                setItems([newEntry, ...items]);

                if (!itemData) {
                    setShowAddModal(false);
                    setNewItem({ name: '', price: '', category: 'Dapur', qty: 1 });
                }
                showNotification("Belanjaan berhasil dicatat!", "success");
            };

            const handleAddTarget = () => {
                if (!newTarget.name || !newTarget.goal) return;
                setTargets([...targets, {
                    id: targets.length + 1,
                    ...newTarget,
                    goal: parseInt(newTarget.goal),
                    saved: parseInt(newTarget.saved) || 0
                }]);
                setShowAddTarget(false);
                setNewTarget({ name: '', goal: '', saved: 0, icon: 'üéØ' });
                showNotification("Target belanja baru dibuat!", "success");
            };

            const handleTabung = (targetId, amount) => {
                const updatedTargets = targets.map(t => {
                    if (t.id === targetId) {
                        return { ...t, saved: t.saved + amount };
                    }
                    return t;
                });
                setTargets(updatedTargets);
                handleAddItem({ name: `Simpanan Belanja Besar`, price: amount, category: 'Tabungan', qty: 1 });
            };

            const handlePayQRIS = () => {
                if (!qrisAmount || qrisAmount <= 0) return;
                handleAddItem({ name: 'Bayar Kasir (QRIS)', price: qrisAmount, category: 'Supermarket', qty: 1 });
                setShowQRIS(false);
                setQrisAmount('');
            };

            const runAIAnalysis = () => {
                setIsAiTyping(true);
                setAiMessage("Mengecek daftar belanjaan dan promo...");

                setTimeout(() => {
                    let advice = "";
                    if (sisaAnggaran < 500000) {
                        advice = `Waduh Bun, uang belanja tinggal Rp ${sisaAnggaran.toLocaleString()}. Kurangi beli snack dulu ya.`;
                    } else if (persentaseSisa > 50) {
                        advice = `Aman terkendali! Sisa uang Rp ${sisaAnggaran.toLocaleString()}. Bisa beli buah-buahan tambahan.`;
                    } else {
                        advice = "Belanjaan cukup standar. Jangan lupa cek promo 'Beli 2 Gratis 1' ya!";
                    }
                    setAiMessage(advice);
                    setIsAiTyping(false);
                }, 2000);
            };

            // Calculator Logic (Harga Satuan)
            useEffect(() => {
                if (calcUnit.price && calcUnit.size) {
                    setCalcUnit(prev => ({ ...prev, result: prev.price / prev.size }));
                }
            }, [calcUnit.price, calcUnit.size]);

            const Dashboard = () => (
                <div className="animate-fade-in space-y-6 pb-24">
                    <div className="relative p-6 rounded-[2rem] overflow-hidden border border-white/10 bg-slate-900/80 shadow-[0_0_30px_rgba(34,211,238,0.2)]">
                        <div className="relative z-10">
                            <div className="flex justify-between items-start">
                                <div>
                                    <p className="text-xs font-bold tracking-widest text-cyan-400 uppercase mb-1">Status Belanja</p>
                                    <h2 className={`text-3xl font-black ${levelColor} drop-shadow-lg`}>{level}</h2>
                                    <div className="flex items-center gap-2 mt-1">
                                        <div className="h-2 w-24 bg-slate-700 rounded-full overflow-hidden">
                                            <div className={`h-full ${levelColor.replace('text', 'bg')}`} style={{ width: `${Math.max(0, persentaseSisa)}%` }}></div>
                                        </div>
                                        <span className="text-[10px] text-gray-400">{persentaseSisa.toFixed(0)}% Sisa Dana</span>
                                    </div>
                                </div>
                                <div className="h-12 w-12 rounded-2xl bg-gradient-to-br from-cyan-600 to-blue-600 flex items-center justify-center shadow-lg transform rotate-3">
                                    <Activity className="text-white" size={24} />
                                </div>
                            </div>

                            <div className="mt-6 flex gap-3">
                                <div className="flex-1 bg-white/5 rounded-xl p-3 border border-white/5 backdrop-blur-sm">
                                    <p className="text-[10px] text-gray-400 uppercase">Sisa Uang</p>
                                    <p className="text-lg font-bold text-white">Rp {sisaAnggaran.toLocaleString()}</p>
                                </div>
                                <div className="flex-1 bg-white/5 rounded-xl p-3 border border-white/5 backdrop-blur-sm">
                                    <p className="text-[10px] text-gray-400 uppercase">Total Struk</p>
                                    <p className="text-lg font-bold text-red-400">Rp {totalPengeluaran.toLocaleString()}</p>
                                </div>
                            </div>
                        </div>
                        <div className="absolute -top-20 -left-20 w-64 h-64 bg-cyan-600/20 rounded-full blur-[80px]"></div>
                        <div className="absolute -bottom-20 -right-20 w-64 h-64 bg-blue-600/20 rounded-full blur-[80px]"></div>
                    </div>

                    <StokChart items={items} />

                    <div className="grid grid-cols-4 gap-3">
                        {[
                            { icon: QrCode, label: 'Kasir', color: 'text-cyan-400', bg: 'bg-cyan-500/10', action: () => setShowQRIS(true) },
                            { icon: Calculator, label: 'Cek Harga', color: 'text-yellow-400', bg: 'bg-yellow-500/10', action: () => setShowCalculator(true) },
                            { icon: Bot, label: 'Tanya AI', color: 'text-purple-400', bg: 'bg-purple-500/10', action: () => { setShowAI(true); runAIAnalysis(); } },
                            { icon: History, label: 'History', color: 'text-emerald-400', bg: 'bg-emerald-500/10', action: () => setShowHistory(true) }
                        ].map((btn, i) => (
                            <button key={i} onClick={btn.action} className={`flex flex-col items-center justify-center gap-2 p-3 rounded-2xl border border-white/5 ${btn.bg} transition hover:scale-95`}>
                                <btn.icon size={20} className={btn.color} />
                                <span className="text-[10px] font-bold text-gray-300">{btn.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );

            const FinanceView = () => (
                <div className="animate-fade-in space-y-6 pb-24">
                    <div className="flex items-center justify-between">
                        <h2 className="text-2xl font-black text-white tracking-tight">Keuangan</h2>
                        <span className="bg-cyan-500/20 text-cyan-300 text-[10px] font-bold px-3 py-1 rounded-full border border-cyan-500/30">EDISI SUPERMARKET</span>
                    </div>

                    <div>
                        <h3 className="font-bold text-sm text-gray-300 flex items-center gap-2 mb-3"><Wallet size={16} className="text-cyan-400" /> Dompet Belanja</h3>
                        <div className="grid grid-cols-3 gap-3">
                            {wallets.map(wallet => (
                                <div key={wallet.id} className={`p-3 rounded-2xl border border-white/5 ${wallet.bg} flex flex-col justify-between h-24 relative overflow-hidden`}>
                                    <div className="relative z-10">
                                        <div className={`mb-1 ${wallet.color}`}>{wallet.icon}</div>
                                        <p className="text-[10px] font-bold text-gray-400">{wallet.name}</p>
                                    </div>
                                    <p className="text-xs font-black text-white relative z-10 truncate">Rp {wallet.balance.toLocaleString()}</p>
                                    <div className={`absolute -right-4 -bottom-4 w-16 h-16 rounded-full opacity-20 ${wallet.bg.replace('/10', '/30')}`}></div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-slate-900/60 border border-white/10 p-5 rounded-3xl">
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="font-bold text-sm text-white flex items-center gap-2"><Zap size={16} className="text-yellow-400" /> Tagihan Rutin</h3>
                            <span className="text-[10px] bg-white/5 px-2 py-1 rounded text-gray-400">Total: Rp {subs.reduce((a, b) => a + b.price, 0).toLocaleString()}</span>
                        </div>
                        <div className="space-y-2">
                            {subs.map(sub => (
                                <div key={sub.id} className="flex justify-between items-center p-3 rounded-xl bg-white/5 border border-white/5">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-slate-800 rounded-lg text-gray-300">{sub.icon}</div>
                                        <div>
                                            <p className="text-xs font-bold text-white">{sub.name}</p>
                                            <p className="text-[10px] text-gray-500">Bayar: {sub.date}</p>
                                        </div>
                                    </div>
                                    <span className="text-xs font-bold text-red-400">-Rp {sub.price.toLocaleString()}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div>
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="font-bold text-sm text-gray-300 flex items-center gap-2"><Target size={16} className="text-blue-500" /> Wishlist / Tabungan</h3>
                            <button onClick={() => setShowAddTarget(true)} className="text-xs font-bold text-cyan-400">+ Target</button>
                        </div>

                        <div className="space-y-3">
                            {targets.map(target => {
                                const progress = Math.min((target.saved / target.goal) * 100, 100);
                                return (
                                    <div key={target.id} className="bg-slate-900/60 border border-white/10 p-4 rounded-2xl relative overflow-hidden">
                                        <div className="flex justify-between items-start mb-2 relative z-10">
                                            <div className="flex items-center gap-3">
                                                <div className="text-2xl bg-white/5 p-2 rounded-xl">{target.icon}</div>
                                                <div>
                                                    <p className="font-bold text-white text-sm">{target.name}</p>
                                                    <p className="text-[10px] text-gray-400">Rp {target.saved.toLocaleString()} / Rp {target.goal.toLocaleString()}</p>
                                                </div>
                                            </div>
                                            <button onClick={() => handleTabung(target.id, 50000)} className="text-[10px] font-bold bg-cyan-500/20 text-cyan-400 px-2 py-1 rounded hover:bg-cyan-500/30 transition">Simpan 50k</button>
                                        </div>
                                        <div className="w-full h-2 bg-slate-700 rounded-full overflow-hidden relative z-10">
                                            <div className="h-full bg-gradient-to-r from-cyan-500 to-blue-500" style={{ width: `${progress}%` }}></div>
                                        </div>
                                    </div>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );

            const Catalog = () => (
                <div className="animate-fade-in space-y-4 pb-24">
                    <div className="flex justify-between items-end mb-2">
                        <h2 className="text-2xl font-black text-white tracking-wide">Daftar Belanja</h2>
                        <button
                            onClick={() => setShowAddModal(true)}
                            className="px-4 py-2 rounded-xl font-bold text-xs shadow-lg flex items-center gap-2 hover:scale-105 transition text-white bg-gradient-to-r from-cyan-600 to-blue-600"
                        >
                            <Plus size={16} /> Tambah Item
                        </button>
                    </div>

                    <div className="space-y-3">
                        {items.map((item) => (
                            <div key={item.id} className="p-4 rounded-2xl border border-white/5 flex items-center gap-4 bg-slate-900/50 hover:bg-slate-800 transition">
                                <div className="h-12 w-12 rounded-xl flex items-center justify-center text-xl bg-white/5 border border-white/5">
                                    {item.image}
                                </div>
                                <div className="flex-1 min-w-0">
                                    <div className="flex justify-between items-start">
                                        <h3 className="font-bold text-sm truncate pr-2 text-white">{item.name}</h3>
                                        <span className="text-[10px] font-bold px-2 py-0.5 rounded uppercase tracking-wide bg-slate-800 text-gray-400">{item.category}</span>
                                    </div>
                                    <p className="text-xs mt-0.5 text-gray-500">{item.qty} {item.unit || 'Pcs'} @ Rp {item.price.toLocaleString()}</p>
                                </div>
                                <div className="text-right">
                                    <div className="font-bold text-sm text-white">Rp {(item.price * item.qty).toLocaleString()}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            return (
                <div className={`min-h-screen font-sans relative overflow-hidden text-white bg-slate-950 selection:bg-cyan-500/30`}>

                    {/* --- BACKGROUND PARTICLES --- */}
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_50%_50%,rgba(34,211,238,0.1),transparent_70%)]"></div>
                        <div className="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] rounded-full blur-[120px] opacity-20 bg-cyan-600 animate-pulse-slow"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] rounded-full blur-[120px] opacity-20 bg-blue-600 animate-pulse-slow delay-1000"></div>
                        <div className="absolute top-10 left-10 h-1 w-1 bg-white rounded-full animate-twinkle"></div>
                        <div className="absolute top-40 right-20 h-1 w-1 bg-white rounded-full animate-twinkle delay-500"></div>
                    </div>

                    {/* --- MODALS --- */}

                    {/* MODAL ADD TARGET */}
                    {showAddTarget && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center px-4 bg-black/80 backdrop-blur-md animate-fade-in">
                            <div className="w-full max-w-sm p-6 rounded-3xl bg-slate-900 border border-slate-700 relative shadow-2xl">
                                <button onClick={() => setShowAddTarget(false)} className="absolute top-4 right-4 text-gray-400"><X size={20} /></button>
                                <h3 className="font-bold mb-4 text-lg text-white">üéØ Target Baru</h3>
                                <div className="space-y-3">
                                    <input type="text" placeholder="Mau beli apa?" value={newTarget.name} onChange={e => setNewTarget({ ...newTarget, name: e.target.value })} className="w-full p-3 bg-slate-800 rounded-xl border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                    <input type="number" placeholder="Butuh dana berapa?" value={newTarget.goal} onChange={e => setNewTarget({ ...newTarget, goal: e.target.value })} className="w-full p-3 bg-slate-800 rounded-xl border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                    <input type="number" placeholder="Udah ada berapa?" value={newTarget.saved} onChange={e => setNewTarget({ ...newTarget, saved: e.target.value })} className="w-full p-3 bg-slate-800 rounded-xl border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                    <button onClick={handleAddTarget} className="w-full py-3 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl font-bold mt-2 text-white hover:opacity-90 transition">Simpan Target</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL CALCULATOR (Unit Price Calculator) */}
                    {showCalculator && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center px-4 bg-black/80 backdrop-blur-md animate-fade-in">
                            <div className="w-full max-w-sm p-6 rounded-3xl bg-slate-900 border border-slate-700 relative shadow-2xl">
                                <button onClick={() => setShowCalculator(false)} className="absolute top-4 right-4 text-gray-400"><X size={20} /></button>
                                <h3 className="font-bold mb-4 flex items-center gap-2 text-yellow-400"><Calculator size={20} /> Cek Harga Satuan</h3>
                                <div className="space-y-3">
                                    <p className="text-xs text-gray-400">Bingung pilih kemasan besar atau kecil? Cek di sini.</p>
                                    <div className="grid grid-cols-1 gap-3">
                                        <input type="number" placeholder="Harga Barang (Rp)" className="p-3 bg-slate-800 rounded-xl border border-slate-700 text-white text-sm" value={calcUnit.price} onChange={(e) => setCalcUnit({ ...calcUnit, price: e.target.value })} />
                                        <input type="number" placeholder="Isi / Berat (Gram/ML/Pcs)" className="p-3 bg-slate-800 rounded-xl border border-slate-700 text-white text-sm" value={calcUnit.size} onChange={(e) => setCalcUnit({ ...calcUnit, size: e.target.value })} />
                                    </div>

                                    {calcUnit.result > 0 && (
                                        <div className="p-4 bg-cyan-500/20 rounded-xl border border-cyan-500/30 mt-2 text-center animate-bounce-in">
                                            <p className="text-xs text-cyan-300 mb-1">Harga Murni:</p>
                                            <p className="text-3xl font-black text-white">Rp {parseFloat(calcUnit.result).toFixed(2)}</p>
                                            <p className="text-[10px] text-gray-400">per Gram / ML / Pcs</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL QRIS (Functional Bayar Kasir) */}
                    {showQRIS && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center px-4 bg-black/80 backdrop-blur-md animate-fade-in">
                            <div className="w-full max-w-sm p-6 rounded-3xl bg-slate-900 border border-slate-700 relative text-center">
                                <button onClick={() => setShowQRIS(false)} className="absolute top-4 right-4"><X size={20} /></button>
                                <h3 className="font-bold mb-6 text-white">Bayar Belanjaan</h3>
                                <div className="bg-white p-4 rounded-xl inline-block mb-4"><QrCode size={180} className="text-black" /></div>
                                <input type="number" placeholder="Total Struk (Rp)" value={qrisAmount} onChange={(e) => setQrisAmount(e.target.value)} className="w-full p-3 bg-slate-800 rounded-xl border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white text-center font-bold mb-2" />
                                <p className="text-sm text-gray-400 mb-4">Sisa Uang: Rp {sisaAnggaran.toLocaleString()}</p>
                                <button onClick={handlePayQRIS} className="w-full py-3 bg-cyan-600 rounded-xl font-bold text-white hover:bg-cyan-500 transition">Konfirmasi Bayar</button>
                            </div>
                        </div>
                    )}

                    {/* MODAL HISTORY */}
                    {showHistory && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center px-4 bg-black/80 backdrop-blur-md animate-fade-in">
                            <div className="w-full max-w-sm h-[400px] flex flex-col p-6 rounded-3xl bg-slate-900 border border-slate-700 text-white">
                                <div className="flex justify-between mb-4"><h3 className="font-bold">Riwayat Belanja</h3><button onClick={() => setShowHistory(false)}><X /></button></div>
                                <div className="flex-1 overflow-auto space-y-3">
                                    {/* Render Actual Items from State */}
                                    {items.map((item) => (
                                        <div key={item.id} className="flex justify-between p-3 bg-slate-800 rounded-xl border border-white/5">
                                            <div><p className="font-bold text-sm">{item.name}</p><p className="text-[10px] text-gray-400">{item.date || 'Baru Saja'}</p></div>
                                            <span className="text-red-400 font-bold text-sm">-Rp {(item.price * item.qty).toLocaleString()}</span>
                                        </div>
                                    ))}
                                    {/* Dummy past data */}
                                    <div className="flex justify-between p-3 bg-slate-800 rounded-xl border border-white/5 opacity-50">
                                        <div><p className="font-bold text-sm">Belanja Mingguan</p><p className="text-[10px] text-gray-400">Minggu Lalu</p></div>
                                        <span className="text-red-400 font-bold text-sm">-Rp 850.000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL TAMBAH BARANG (SUPERMARKET INPUT) */}
                    {showAddModal && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center px-4 bg-black/70 backdrop-blur-sm animate-fade-in">
                            <div className="w-full max-w-sm p-6 rounded-3xl bg-slate-900 border border-slate-700 text-white shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-bold">Catat Belanjaan</h3>
                                    <button onClick={() => setShowAddModal(false)} className="opacity-50 hover:opacity-100"><X size={20} /></button>
                                </div>
                                <div className="space-y-4">
                                    <input type="text" placeholder="Nama Barang (ex: Kopi Kapal Api)" value={newItem.name} onChange={e => setNewItem({ ...newItem, name: e.target.value })} className="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <input type="number" placeholder="Harga Satuan" value={newItem.price} onChange={e => setNewItem({ ...newItem, price: e.target.value })} className="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                        <input type="number" placeholder="Jml Beli (Qty)" value={newItem.qty} onChange={e => setNewItem({ ...newItem, qty: e.target.value })} className="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm focus:border-cyan-500 outline-none text-white" />
                                    </div>
                                    <select value={newItem.category} onChange={e => setNewItem({ ...newItem, category: e.target.value })} className="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-sm outline-none text-gray-300">
                                        <option>Dapur</option><option>Makanan</option><option>Minuman</option><option>Kebersihan</option><option>Lainnya</option>
                                    </select>
                                    <button onClick={handleAddItem} className="w-full py-3 rounded-xl font-bold text-white shadow-lg mt-2 bg-gradient-to-r from-cyan-600 to-blue-600 hover:opacity-90">Simpan ke Keranjang</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* AI MODAL */}
                    {showAI && (
                        <div className="fixed bottom-24 left-4 right-4 z-[60] p-4 rounded-3xl shadow-2xl border border-slate-700 bg-slate-900/95 backdrop-blur-md animate-slide-up">
                            <div className="flex gap-3">
                                <div className="p-2 h-10 w-10 rounded-full flex items-center justify-center shrink-0 bg-yellow-500 text-white"><Bot size={20} /></div>
                                <div className="flex-1">
                                    <h4 className="font-bold text-sm mb-1 text-yellow-300">Asisten Belanja</h4>
                                    <div className="text-xs leading-relaxed p-3 rounded-xl bg-slate-800 border border-slate-700 text-gray-300">
                                        {isAiTyping ? <span className="animate-pulse">Menghitung diskon...</span> : aiMessage}
                                    </div>
                                </div>
                                <button onClick={() => setShowAI(false)} className="h-8 w-8 flex items-center justify-center opacity-50 hover:opacity-100"><X size={16} /></button>
                            </div>
                        </div>
                    )}

                    {/* Notifikasi */}
                    {notification && (
                        <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-[70] px-4 py-2 rounded-full shadow-lg flex items-center gap-2 text-xs font-bold animate-bounce-in bg-slate-900 border border-white/20 text-white`}>
                            {notification.type === 'error' ? <AlertCircle size={14} className="text-red-500" /> : <Check size={14} className="text-green-500" />} {notification.msg}
                        </div>
                    )}

                    {/* --- KONTEN UTAMA --- */}
                    <main className="relative z-10 max-w-md mx-auto min-h-screen px-5 pt-8 flex flex-col">

                        {/* Header App */}
                        <div className="flex items-center justify-between mb-8 animate-fade-in">
                            <div className="flex items-center gap-2.5">
                                <div className="p-2.5 rounded-xl shadow-lg bg-slate-800 text-cyan-400 border border-white/10">
                                    <Package size={22} fill="currentColor" fillOpacity={0.2} />
                                </div>
                                <div>
                                    <h1 className="text-lg font-black leading-none text-white tracking-wide">RAMAWAN</h1>
                                    <p className="text-[10px] font-bold opacity-60 tracking-[0.2em] mt-0.5 text-cyan-200">SUPERMARKET</p>
                                </div>
                            </div>
                            <div className="h-10 w-10 rounded-full bg-slate-800 border border-white/10 flex items-center justify-center">
                                <ShoppingBag size={20} className="text-gray-400" />
                            </div>
                        </div>

                        {/* Dynamic View */}
                        {currentView === 'dashboard' && <Dashboard />}
                        {currentView === 'finance' && <FinanceView />}
                        {currentView === 'catalog' && <Catalog />}

                    </main>

                    {/* --- MENU BAWAH (NAVBAR) --- */}
                    <nav className="fixed bottom-6 left-4 right-4 max-w-md mx-auto z-50">
                        <div className="backdrop-blur-xl border rounded-[2rem] p-2 shadow-2xl flex justify-between items-center px-4 transition-colors duration-500 bg-slate-900/90 border-white/10">
                            <NavButton active={currentView === 'dashboard'} onClick={() => setCurrentView('dashboard')} icon={BarChart2} label="Belanja" />
                            <NavButton active={currentView === 'finance'} onClick={() => setCurrentView('finance')} icon={Wallet} label="Dompet" />

                            <div className="relative -top-8 px-2">
                                <button
                                    onClick={() => setShowAddModal(true)}
                                    className="h-14 w-14 rounded-full shadow-lg flex items-center justify-center border-[4px] transition-transform active:scale-90 text-white border-slate-900 bg-gradient-to-tr from-cyan-500 to-blue-500 hover:scale-105"
                                >
                                    <Plus size={28} />
                                </button>
                            </div>

                            <NavButton active={currentView === 'catalog'} onClick={() => setCurrentView('catalog')} icon={List} label="List" />
                            <NavButton active={showAI} onClick={() => { setShowAI(true); runAIAnalysis(); }} icon={Bot} label="Asisten" />
                        </div>
                    </nav>
                </div>
            );
        };

        const NavButton = ({ active, onClick, icon: Icon, label }) => (
            <button
                onClick={onClick}
                className={`flex flex-col items-center gap-1 p-2 rounded-xl transition-all duration-300 ${active ? 'scale-110 text-cyan-400' : 'text-gray-500 hover:text-gray-300'}`}
            >
                <Icon size={20} strokeWidth={active ? 2.5 : 2} className={active ? 'drop-shadow-[0_0_8px_currentColor]' : ''} />
                <span className={`text-[9px] font-bold transition-opacity ${active ? 'opacity-100' : 'opacity-0'}`}>{label}</span>
            </button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>